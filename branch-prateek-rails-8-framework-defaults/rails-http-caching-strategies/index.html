<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.avif">











<!-- Primary Meta Tags -->
<title>HTTP Caching for Rails APIs: The Missing Performance Layer | Prateek Codes - Learn Building Scalable Backend Systems</title>
<meta name="title" content="HTTP Caching for Rails APIs: The Missing Performance Layer">
<meta name="description" content="Most Rails APIs ignore HTTP caching entirely, missing out on massive performance gains. Learn practical caching strategies that can reduce server load b...">
<meta name="keywords" content="rails api caching, http caching rails, cache-control headers, etags rails, conditional get rails, api performance optimization, Rails, Performance, API, Ruby on Rails, PostgreSQL, Ruby, Rails development, Rails consulting">
<meta name="author" content="Prateek Choudhary">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="article">
<meta property="og:url" content="https://prateekcodes.dev/rails-http-caching-strategies/">
<meta property="og:title" content="HTTP Caching for Rails APIs: The Missing Performance Layer">
<meta property="og:description" content="Most Rails APIs ignore HTTP caching entirely, missing out on massive performance gains. Learn practical caching strategies that can reduce server load b...">
<meta property="og:image" content="https://prateekcodes.dev/assets/images/logo.avif">
<meta property="og:site_name" content="Prateek Codes - Learn Building Scalable Backend Systems">

<meta property="article:author" content="Prateek Choudhary">
<meta property="article:published_time" content="2025-06-29T00:00:00+00:00">


<meta property="article:tag" content="rails">

<meta property="article:tag" content="http-caching">

<meta property="article:tag" content="api">

<meta property="article:tag" content="performance">

<meta property="article:tag" content="cache-control">

<meta property="article:tag" content="etags">



<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://prateekcodes.dev/rails-http-caching-strategies/">
<meta property="twitter:title" content="HTTP Caching for Rails APIs: The Missing Performance Layer">
<meta property="twitter:description" content="Most Rails APIs ignore HTTP caching entirely, missing out on massive performance gains. Learn practical caching strategies that can reduce server load b...">
<meta property="twitter:image" content="https://prateekcodes.dev/assets/images/logo.avif">
<meta property="twitter:creator" content="@prateekkish">

<!-- Canonical URL -->
<link rel="canonical" href="https://prateekcodes.dev/rails-http-caching-strategies/">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Prateek Codes - Learn Building Scalable Backend Systems RSS Feed" href="https://prateekcodes.dev/feed.xml">






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "HTTP Caching for Rails APIs: The Missing Performance Layer",
  "description": "Most Rails APIs ignore HTTP caching entirely, missing out on massive performance gains. Learn practical caching strategies that can reduce server load b...",
  
  "image": "https://prateekcodes.dev/assets/images/logo.avif",
  
  "datePublished": "2025-06-29T00:00:00+00:00",
  
  "dateModified": "2025-06-29T00:00:00+00:00",
  
  "author": {
    "@type": "Person",
    "name": "Prateek Choudhary",
    "url": "https://prateekcodes.dev",
    "sameAs": [
      "https://twitter.com/prateekkish",
      "https://www.linkedin.com/in/choudharyprateek/",
      "https://github.com/prateekkish"
    ]
  },
  "publisher": {
    "@type": "Organization",
    "name": "Prateek Codes - Learn Building Scalable Backend Systems",
    "logo": {
      "@type": "ImageObject",
      "url": "https://prateekcodes.dev/assets/images/logo.avif"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://prateekcodes.dev/rails-http-caching-strategies/"
  },
  "keywords": "rails, http-caching, api, performance, cache-control, etags, Rails, Performance, API",
  "articleSection": "Rails",
  "wordCount": "1428"
}
</script>





<!-- Breadcrumb Navigation -->

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://prateekcodes.dev"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Rails",
      "item": "https://prateekcodes.dev/category/rails"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "HTTP Caching for Rails APIs...",
      "item": "https://prateekcodes.dev/rails-http-caching-strategies/"
    }
  ]
}
</script>


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">



<script src="/assets/js/jquery.min.js"></script>

</head>


<!-- change your GA id in _config.yml -->
<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-158773406-2', 'auto');
    ga('send', 'pageview');
  </script>



<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img class="navbar-logo" src="/assets/images/logo.avif" alt="Prateek Codes - Learn Building Scalable Backend Systems" width="50px" height="">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item ">
                    <a class="nav-link" href="/">Blog</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/categories">Categories</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/projects">Projects</a>
                </li>
                

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Search a post..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-1 pl-0">
            
        </div>

        <!-- Post -->
        

        <div class="col-md-10 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Post Title -->
                <h1 class="posttitle">HTTP Caching for Rails APIs: The Missing Performance Layer</h1>

            </div>            

            <!-- Post Featured Image -->
            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <p>Every Rails developer knows the caching dance. We’ve all implemented <a href="https://guides.rubyonrails.org/caching_with_rails.html#fragment-caching" target="_blank" rel="noopener noreferrer">fragment caching</a>, played with <code class="language-plaintext highlighter-rouge">Rails.cache</code>, and maybe even ventured into <a href="https://guides.rubyonrails.org/caching_with_rails.html#russian-doll-caching" target="_blank" rel="noopener noreferrer">Russian doll caching</a>. But here’s what I’ve seen being completely ignored: <strong>HTTP caching</strong>.</p>

<p>Here’s the thing - HTTP caching can eliminate up to 90% of your API requests without you writing a single line of caching logic. It’s built into every HTTP client worth using, requires zero infrastructure, and costs nothing to implement.</p>

<p>Yet most Rails APIs serve every request fresh, ignoring decades of HTTP specification designed specifically to solve this problem.</p>

<h2 id="the-hidden-cost-of-ignoring-http-caching">The Hidden Cost of Ignoring HTTP Caching</h2>

<p>Let’s start with a typical Rails API endpoint:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Api::ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="n">render</span> <span class="ss">json: </span><span class="vi">@product</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Every request to this endpoint:</p>
<ul>
  <li>Hits your Rails server</li>
  <li>Queries your database</li>
  <li>Serializes the response</li>
  <li>Consumes server resources</li>
</ul>

<p>Even if the product hasn’t changed in months.</p>

<p>Now imagine this endpoint serves a mobile app with 100,000 daily active users, each checking product details multiple times per day. That’s millions of unnecessary requests, database queries, and server cycles.</p>

<h2 id="rails-csrf-problem-and-why-apis-dont-have-it">Rails’ CSRF Problem (And Why APIs Don’t Have It)</h2>

<p>Before diving into solutions, let’s address why HTTP caching is rarely discussed in Rails circles. Rails applications typically embed CSRF tokens in every HTML response:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"csrf-token"</span> <span class="na">content=</span><span class="s">"Xc0vf6L7hgb..."</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This token changes on every request, making HTML responses effectively uncacheable. But APIs don’t have this problem - they typically use token-based authentication without CSRF protection.</p>

<p>This makes APIs the perfect candidate for aggressive HTTP caching strategies.</p>

<h2 id="hello-cache-control">Hello Cache-Control</h2>

<p>The <code class="language-plaintext highlighter-rouge">Cache-Control</code> header is where the magic happens. It tells clients and CDNs exactly how to cache your responses. Here’s what a properly cached API response looks like:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Api::ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">[</span><span class="s1">'Cache-Control'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'public, max-age=3600'</span>
    <span class="n">render</span> <span class="ss">json: </span><span class="vi">@product</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This simple header tells clients to cache the response for one hour (3600 seconds). During that hour, the client won’t make another request - it’ll serve the cached version instead.</p>

<p>But we can do better.</p>

<h2 id="conditional-requests-the-smart-way-to-cache">Conditional Requests: The Smart Way to Cache</h2>

<p>What happens after that hour expires? The client makes a new request and we start over? Not quite. This is where conditional requests shine.</p>

<h3 id="using-last-modified">Using Last-Modified</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Api::ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">stale?</span><span class="p">(</span><span class="ss">last_modified: </span><span class="vi">@product</span><span class="p">.</span><span class="nf">updated_at</span><span class="p">)</span>
      <span class="n">render</span> <span class="ss">json: </span><span class="vi">@product</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">stale?</code> method is Rails magic that checks if the resource has been modified since the client last fetched it. It automatically sets the appropriate headers and returns <code class="language-plaintext highlighter-rouge">false</code> if the content is fresh (triggering a 304 response).</p>

<p>Here’s what happens:</p>
<ol>
  <li>First request: Client receives the product with a <code class="language-plaintext highlighter-rouge">Last-Modified</code> header</li>
  <li>Subsequent requests: Client sends <code class="language-plaintext highlighter-rouge">If-Modified-Since</code> header</li>
  <li>If product hasn’t changed: Rails returns <code class="language-plaintext highlighter-rouge">304 Not Modified</code> (no body)</li>
  <li>If product has changed: Rails returns the full response</li>
</ol>

<p>The beauty? When nothing changes, you save:</p>
<ul>
  <li>JSON serialization time</li>
  <li>Response body bandwidth</li>
  <li>Client parsing time</li>
</ul>

<h3 id="using-etags-for-more-complex-scenarios">Using ETags for More Complex Scenarios</h3>

<p>Sometimes <code class="language-plaintext highlighter-rouge">updated_at</code> isn’t enough. Maybe your response includes associated data or computed fields:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Api::ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="c1"># ETag based on product and its associations</span>
    <span class="n">etag</span> <span class="o">=</span> <span class="p">[</span>
      <span class="vi">@product</span><span class="p">,</span>
      <span class="vi">@product</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="ss">:updated_at</span><span class="p">),</span>
      <span class="vi">@product</span><span class="p">.</span><span class="nf">current_price</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">stale?</span><span class="p">(</span><span class="ss">etag: </span><span class="n">etag</span><span class="p">)</span>
      <span class="n">render</span> <span class="ss">json: </span><span class="p">{</span>
        <span class="ss">product: </span><span class="vi">@product</span><span class="p">,</span>
        <span class="ss">review_count: </span><span class="vi">@product</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">count</span><span class="p">,</span>
        <span class="ss">average_rating: </span><span class="vi">@product</span><span class="p">.</span><span class="nf">reviews</span><span class="p">.</span><span class="nf">average</span><span class="p">(</span><span class="ss">:rating</span><span class="p">),</span>
        <span class="ss">current_price: </span><span class="vi">@product</span><span class="p">.</span><span class="nf">current_price</span>
      <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Rails automatically generates an ETag from the array, creating a unique fingerprint for this exact response state.</p>

<h2 id="advanced-patterns-for-real-world-apis">Advanced Patterns for Real-World APIs</h2>

<h3 id="pattern-1-efficient-collection-caching">Pattern 1: Efficient Collection Caching</h3>

<p>Caching collections requires thinking about what actually changes:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Api::ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="p">.</span><span class="nf">active</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:category</span><span class="p">)</span>

    <span class="c1"># Use the most recent update as the collection's last modified time</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="vi">@products</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="ss">:updated_at</span><span class="p">)</span>

    <span class="c1"># Include collection "fingerprint" in ETag</span>
    <span class="n">etag_components</span> <span class="o">=</span> <span class="p">[</span>
      <span class="n">last_modified</span><span class="p">,</span>
      <span class="vi">@products</span><span class="p">.</span><span class="nf">count</span><span class="p">,</span>
      <span class="n">params</span><span class="p">[</span><span class="ss">:page</span><span class="p">],</span>
      <span class="n">params</span><span class="p">[</span><span class="ss">:per_page</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">stale?</span><span class="p">(</span><span class="ss">last_modified: </span><span class="n">last_modified</span><span class="p">,</span> <span class="ss">etag: </span><span class="n">etag_components</span><span class="p">)</span>
      <span class="n">render</span> <span class="ss">json: </span><span class="vi">@products</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="pattern-2-user-specific-caching">Pattern 2: User-Specific Caching</h3>

<p>Private data needs private caching:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Api::OrdersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@orders</span> <span class="o">=</span> <span class="n">current_user</span><span class="p">.</span><span class="nf">orders</span><span class="p">.</span><span class="nf">recent</span>

    <span class="c1"># Private ensures CDNs don't cache user-specific data</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">[</span><span class="s1">'Cache-Control'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'private, max-age=300'</span>

    <span class="k">if</span> <span class="n">stale?</span><span class="p">(</span><span class="ss">last_modified: </span><span class="vi">@orders</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="ss">:updated_at</span><span class="p">))</span>
      <span class="n">render</span> <span class="ss">json: </span><span class="vi">@orders</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="pattern-3-preventing-unnecessary-queries">Pattern 3: Preventing Unnecessary Queries</h3>

<p>The real power comes from avoiding database queries entirely:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Api::TimelineController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="c1"># Only check if we need to regenerate</span>
    <span class="n">latest_update</span> <span class="o">=</span> <span class="n">current_user</span><span class="p">.</span><span class="nf">posts</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="ss">:updated_at</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">stale?</span><span class="p">(</span><span class="ss">last_modified: </span><span class="n">latest_update</span><span class="p">)</span>
      <span class="c1"># Only now do we load the actual data</span>
      <span class="vi">@posts</span> <span class="o">=</span> <span class="n">current_user</span><span class="p">.</span><span class="nf">posts</span>
                          <span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:comments</span><span class="p">,</span> <span class="ss">:likes</span><span class="p">)</span>
                          <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">created_at: :desc</span><span class="p">)</span>
                          <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

      <span class="n">render</span> <span class="ss">json: </span><span class="vi">@posts</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">maximum(:updated_at)</code> query is lightning fast compared to loading full records.</p>

<h2 id="cache-control-directives-that-actually-matter">Cache-Control Directives That Actually Matter</h2>

<p>While the HTTP spec defines many cache directives, here are the ones that actually matter for Rails APIs:</p>

<p><strong><code class="language-plaintext highlighter-rouge">max-age=seconds</code></strong> - How long to cache before checking again</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="s1">'public, max-age=3600'</span> <span class="c1"># Cache for 1 hour</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">private</code> vs <code class="language-plaintext highlighter-rouge">public</code></strong> - Who can cache this</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="s1">'private, max-age=300'</span> <span class="c1"># Only browser can cache (user data)</span>
<span class="s1">'public, max-age=3600'</span>  <span class="c1"># CDNs can cache too (public data)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">no-store</code></strong> - Never cache this</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="s1">'no-store'</span> <span class="c1"># For sensitive data like payment info</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">must-revalidate</code></strong> - Always check when stale</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="s1">'public, max-age=3600, must-revalidate'</span> <span class="c1"># Don't serve stale content</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="real-world-implementation-strategy">Real-World Implementation Strategy</h2>

<h3 id="step-1-identify-cacheable-endpoints">Step 1: Identify Cacheable Endpoints</h3>

<p>Start with read-heavy, public endpoints:</p>
<ul>
  <li>Product catalogs</li>
  <li>Blog posts / articles</li>
  <li>Category listings</li>
  <li>Static configuration</li>
</ul>

<h3 id="step-2-add-conditional-caching">Step 2: Add Conditional Caching</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">API</span>
  <span class="c1"># Helper for consistent caching</span>
  <span class="k">def</span> <span class="nf">cache_publicly</span><span class="p">(</span><span class="ss">max_age: </span><span class="mi">1</span><span class="p">.</span><span class="nf">hour</span><span class="p">)</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">[</span><span class="s1">'Cache-Control'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"public, max-age=</span><span class="si">#{</span><span class="n">max_age</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">cache_privately</span><span class="p">(</span><span class="ss">max_age: </span><span class="mi">5</span><span class="p">.</span><span class="nf">minutes</span><span class="p">)</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">headers</span><span class="p">[</span><span class="s1">'Cache-Control'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"private, max-age=</span><span class="si">#{</span><span class="n">max_age</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-3-monitor-and-iterate">Step 3: Monitor and Iterate</h3>

<p>Track your cache hit rates:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">API</span>
  <span class="n">after_action</span> <span class="ss">:log_cache_status</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">log_cache_status</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="nf">status</span> <span class="o">==</span> <span class="mi">304</span>
      <span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"[CACHE HIT] </span><span class="si">#{</span><span class="n">request</span><span class="p">.</span><span class="nf">path</span><span class="si">}</span><span class="s2">"</span>
      <span class="c1"># Increment your metrics here</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="the-gotchas">The Gotchas</h2>

<h3 id="gotcha-1-middleware-order-matters">Gotcha 1: Middleware Order Matters</h3>

<p>Rails middleware can modify responses after your controller runs. Make sure caching headers aren’t being overwritten:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1"># config/application.rb</span>
<span class="n">config</span><span class="p">.</span><span class="nf">middleware</span><span class="p">.</span><span class="nf">insert_before</span> <span class="no">Rack</span><span class="o">::</span><span class="no">ETag</span><span class="p">,</span> <span class="no">YourFancyMiddleware</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="gotcha-2-serializer-caching">Gotcha 2: Serializer Caching</h3>

<p>If you’re using <code class="language-plaintext highlighter-rouge">ActiveModel::Serializers</code> or similar, ensure they respect caching:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">ProductSerializer</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Serializer</span>
  <span class="n">cache</span> <span class="ss">key: </span><span class="s1">'product'</span><span class="p">,</span> <span class="ss">expires_in: </span><span class="mi">1</span><span class="p">.</span><span class="nf">hour</span>

  <span class="n">attributes</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:price</span>

  <span class="c1"># This computed attribute could break caching</span>
  <span class="n">attribute</span> <span class="ss">:current_discount</span> <span class="k">do</span>
    <span class="c1"># Make sure this is deterministic!</span>
    <span class="n">object</span><span class="p">.</span><span class="nf">calculate_discount</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="gotcha-3-time-zones-and-timestamps">Gotcha 3: Time Zones and Timestamps</h3>

<p>Always use UTC for Last-Modified headers:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="n">stale?</span><span class="p">(</span><span class="ss">last_modified: </span><span class="vi">@product</span><span class="p">.</span><span class="nf">updated_at</span><span class="p">.</span><span class="nf">utc</span><span class="p">)</span>
  <span class="n">render</span> <span class="ss">json: </span><span class="vi">@product</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="measuring-success">Measuring Success</h2>

<p>How do you know if your HTTP caching strategy is working? Look for:</p>

<ol>
  <li><strong>Reduced average response times</strong> - 304 responses are typically 10x faster</li>
  <li><strong>Lower database load</strong> - Fewer queries hitting your database</li>
  <li><strong>Improved mobile app performance</strong> - Users see instant responses for cached data</li>
  <li><strong>Reduced bandwidth costs</strong> - 304 responses have no body</li>
</ol>

<p>A well-cached API can handle 10x the traffic with the same infrastructure.</p>

<h2 id="your-next-steps">Your Next Steps</h2>

<p>HTTP caching isn’t a silver bullet, but it’s the closest thing we have in API performance. Start small:</p>

<ol>
  <li>Pick your most-requested endpoint</li>
  <li>Add simple Last-Modified caching</li>
  <li>Measure the impact</li>
  <li>Iterate from there</li>
</ol>

<p>Remember: the fastest API request is the one that never hits your server. HTTP caching makes that possible without complex infrastructure or code changes.</p>

<p>The best part? Your mobile developers will love you for it. Their apps will feel instantly responsive, work better offline, and consume less battery and data.</p>

<p>That’s a win for everyone.</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://api.rubyonrails.org/classes/ActionController/ConditionalGet.html" target="_blank" rel="noopener noreferrer">Rails Conditional GET Support</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching" target="_blank" rel="noopener noreferrer">MDN HTTP Caching Guide</a></li>
  <li><a href="https://tools.ietf.org/html/rfc7234" target="_blank" rel="noopener noreferrer">RFC 7234 - HTTP/1.1 Caching</a></li>
</ul>

            </div>

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2025-06-29">29 Jun 2025</time></span>
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#API">API</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Performance">Performance</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Rails">Rails</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Author Box -->
            
            <div class="row post-bottom-meta">
                <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                    
                    <img class="author-thumb" src="/assets/images/prateek-avatar.avif" alt="Prateek Choudhary">
                    
                </div>
                <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                    <a target="_blank" class="link-dark" href="prateekcodes.dev">Prateek Choudhary</a>
                    <section class="author-socials mb-0">
                        <a target="_blank" href="https://twitter.com/prateekkish"><i class="fab fa-twitter-square"></i></a>
                        <a target="_blank" href="https://github.com/prateekkish" class="ml-1"><i class="fab fa-github-square"></i></a>
                        <a target="_blank" href="https://www.linkedin.com/in/choudharyprateek/" class="ml-1"><i class="fab fa-linkedin"></i></a>
                        <a target="_blank" href="mailto:prateekkish@gmail.com" class="ml-1"><i class="fas fa-envelope-square"></i></a>
                    </section>
                    <section class="author-description">Technology Leader</section>
                </div>
            </div>
            
            <!-- End Author Box -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#api">#api</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#cache-control">#cache-control</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#etags">#etags</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#http-caching">#http-caching</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#performance">#performance</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#rails">#rails</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Related Posts -->
            





<div class="related-posts">
  <h3>Related Articles</h3>
  <div class="row">
    
      
        
        
        
        
        
        
      
    
      
        
        
        
        
        
        
          <div class="col-md-6 mb-3">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">
                  <a href="/rails-8-multiple-rate-limits-per-controller/">Rails 8 adds ability to use multiple rate limits per controller</a>
                </h5>
                <p class="card-text small">Rails 8 now allows defining multiple rate limits within a single controller using named configura...</p>
                <p class="card-text">
                  <small class="text-muted">
                    <time datetime="2025-07-04T00:00:00+00:00">Jul 04, 2025</time>
                  </small>
                </p>
              </div>
            </div>
          </div>
          
          
        
      
    
      
        
        
        
        
        
        
      
    
      
    
      
        
        
        
        
        
        
          <div class="col-md-6 mb-3">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">
                  <a href="/rails-performance-80-20-rule/">Why your Rails performance fixes don't work (and how to find ones that do)</a>
                </h5>
                <p class="card-text small">Stop wasting time optimizing code that doesn't matter. Learn how to use the Pareto Principle and ...</p>
                <p class="card-text">
                  <small class="text-muted">
                    <time datetime="2025-06-28T00:00:00+00:00">Jun 28, 2025</time>
                  </small>
                </p>
              </div>
            </div>
          </div>
          
          
        
      
    
      
        
        
        
        
        
        
          <div class="col-md-6 mb-3">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">
                  <a href="/rails-8-framework-defaults/">What are the new Rails 8 framework defaults?</a>
                </h5>
                <p class="card-text small">Rails 8 framework defaults include timezone preservation in to_time methods, strict HTTP freshnes...</p>
                <p class="card-text">
                  <small class="text-muted">
                    <time datetime="2025-06-28T00:00:00+00:00">Jun 28, 2025</time>
                  </small>
                </p>
              </div>
            </div>
          </div>
          
          
        
      
    
      
        
        
        
        
        
        
      
    
      
        
        
        
        
        
        
      
    
      
        
        
        
        
        
        
      
    
      
        
        
        
        
        
        
      
    
      
        
        
        
        
        
        
      
    
      
        
        
        
        
        
        
      
    
      
        
        
        
        
        
        
      
    
      
        
        
        
        
        
        
      
    
    
    
    
  </div>
</div>
            <!-- End Related Posts -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-10">
                <script src="https://giscus.app/client.js"
        data-repo="prateekkish/prateekcodes"
        data-repo-id=""
        data-category="General"
        data-category-id=""
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light_protanopia"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

</script>

</div>



</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row mb-4">
            <div class="col-md-12 text-center">
                <div class="contact-section">
                    <h5 class="contact-title">Let's Work Together</h5>
                    <p class="contact-subtitle">Need help scaling your backend systems? I can help you build robust, high-performance solutions.</p>
                    <div class="contact-links">
                        <a href="mailto:prateekkish@gmail.com" class="contact-link email-link">
                            <i class="fas fa-envelope"></i> Get in touch
                        </a>
                        <span class="contact-divider">•</span>
                        <a href="https://twitter.com/prateekkish" class="contact-link" target="_blank">
                            <i class="fab fa-twitter"></i> Twitter
                        </a>
                        <span class="contact-divider">•</span>
                        <a href="https://www.linkedin.com/in/choudharyprateek/" class="contact-link" target="_blank">
                            <i class="fab fa-linkedin"></i> LinkedIn
                        </a>
                        <span class="contact-divider">•</span>
                        <a href="https://github.com/prateekkish" class="contact-link" target="_blank">
                            <i class="fab fa-github"></i> GitHub
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <hr class="footer-divider">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2025 Prateek Codes - Learn Building Scalable Backend Systems
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">
                Built with Jekyll
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script>

</body>
</html>
